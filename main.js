(()=>{"use strict";var t="https://mesto.nomoreparties.co/v1/wff-cohort-9",e="184de017-a3ae-4aa3-8f19-c2b639eb78c3",o="application/json",n="89188d4a989569994e21b11a",r=fetch("".concat(t,"/users/me"),{method:"GET",headers:{authorization:"".concat(e)}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})),c=fetch("".concat(t,"/cards"),{method:"GET",headers:{authorization:"".concat(e)}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}));function u(n,r,c){var u=c.querySelector(".card__like-button").classList.contains("card__like-button_is-active");n.target.classList.toggle("card__like-button_is-active"),u?fetch("".concat(t,"/cards/likes/").concat(r._id),{method:"DELETE",headers:{authorization:"".concat(e),"Content-Type":"".concat(o)}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).then((function(t){c.querySelector(".card__like-count").textContent=t.likes.length})).catch((function(t){console.log(t)})):fetch("".concat(t,"/cards/likes/").concat(r._id),{method:"PUT",headers:{authorization:"".concat(e),"Content-Type":"".concat(o)},body:JSON.stringify({likes:"".concat(r.owner)})}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).then((function(t){c.querySelector(".card__like-count").textContent=t.likes.length})).catch((function(t){console.log(t)}))}function i(o,n){o.target.closest(".card").remove(),fetch("".concat(t,"/cards/").concat(n._id),{method:"DELETE",headers:{authorization:"".concat(e)}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).catch((function(t){console.log(t)}))}function a(t,e){t.likes.forEach((function(t){return t._id===n?e.querySelector(".card__like-button").classList.add("card__like-button_is-active"):e.querySelector(".card__like-button").classList.remove("card__like-button_is-active")}))}function p(t,e,o,r,c){var u=document.querySelector("#card-template").content.querySelector(".card").cloneNode(!0);return u.querySelector(".card__image").src=t.link,u.querySelector(".card__image").alt=t.name,u.querySelector(".card__title").textContent=t.name,u.querySelector(".card__like-count").textContent=t.likes.length,t.owner._id===n?(u.querySelector(".card__delete-button").classList.remove("card__delete-button_invisible"),u.querySelector(".card__delete-button").disabled=!1):(u.querySelector(".card__delete-button").classList.add("card__delete-button_invisible"),u.querySelector(".card__delete-button").disabled=!0),c(t,u),u.querySelector(".card__image").addEventListener("click",(function(){r(t)})),u.querySelector(".card__like-button").addEventListener("click",(function(e){o(e,t,u)})),u.querySelector(".card__delete-button").addEventListener("click",(function(o){e(o,t)})),u}function l(t){t.classList.add("popup_is-opened"),document.addEventListener("keydown",_)}function s(t){t.classList.remove("popup_is-opened"),document.removeEventListener("keydown",_)}function _(t){"Escape"===t.key&&s(document.querySelector(".popup_is-opened"))}function d(t){return t.some((function(t){return!t.validity.valid}))}function f(t,e,o){d(t)&&(e.disabled=!0,e.classList.add(o))}function m(t,e,o){d(t)||(e.disabled=!1,e.classList.remove(o))}function y(t){var e,o,n,r,c,u,i,a,p=document.querySelector(".popup_is-opened").querySelector(t.formSelector);e=p,o=t.inputSelector,n=t.submitButtonSelector,r=t.inactiveButtonClass,c=t.inputErrorClass,u=t.errorClass,i=Array.from(e.querySelectorAll(o)),a=e.querySelector(n),f(i,a,r),i.forEach((function(t){t.addEventListener("input",(function(){!function(t,e,o,n){e.validity.patternMismatch&&e.setCustomValidity(e.dataset.errorMessage),e.validity.valid||function(t,e,o,n,r){var c=t.querySelector(".".concat(e.id,"-error"));e.classList.add(n),c.textContent=o,c.classList.add(r)}(t,e,e.validationMessage,o,n)}(e,t,c,u),f(i,a,r)}))}))}function v(t,e){var o,n,r,c,u,i,a,p;o=t,n=e.inputSelector,r=e.submitButtonSelector,c=e.inactiveButtonClass,u=e.inputErrorClass,i=e.errorClass,a=Array.from(o.querySelectorAll(n)),p=o.querySelector(r),m(a,p,c),a.forEach((function(t){t.addEventListener("input",(function(){!function(t,e,o,n){e.validity.patternMismatch||e.setCustomValidity(""),e.validity.valid&&function(t,e,o,n){var r=t.querySelector(".".concat(e.id,"-error"));e.classList.remove(o),r.classList.remove(n),r.textContent=""}(t,e,o,n)}(o,t,u,i),m(a,p,c)}))}))}function S(t,e){(null==e||e>t.length)&&(e=t.length);for(var o=0,n=new Array(e);o<e;o++)n[o]=t[o];return n}var h=document.querySelector(".content").querySelector(".places__list"),b=document.querySelectorAll(".popup"),q=document.querySelector(".popup_type_avatar"),C=document.querySelector(".popup_type_edit"),k=document.querySelector(".popup_type_new-card"),g=document.querySelector(".popup_type_image"),E=g.querySelector(".popup__image"),L=g.querySelector(".popup__caption"),j=document.querySelector(".profile__image"),B=document.querySelector(".profile__edit-button"),x=document.querySelector(".profile__add-button"),T=q.querySelector(".popup__form"),A=C.querySelector(".popup__form"),P=k.querySelector(".popup__form"),w=document.querySelector(".profile__title"),O=document.querySelector(".profile__description"),z=P.querySelector(".popup__input_type_card-name"),D=P.querySelector(".popup__input_type_url"),I=T.querySelector(".popup__input_avatar_url"),M=A.querySelector(".popup__input_type_name"),N=A.querySelector(".popup__input_type_description"),J="",G="",H="",U={};function V(t){l(g),E.src=t.link,E.alt=t.name,L.textContent=t.name}function $(t,e){t.querySelector(".popup__button").textContent=e?"Сохранение...":"Сохранить"}Promise.all([r,c]).then((function(t){var e,o,n=(o=2,function(t){if(Array.isArray(t))return t}(e=t)||function(t,e){var o=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=o){var n,r,c,u,i=[],a=!0,p=!1;try{if(c=(o=o.call(t)).next,0===e){if(Object(o)!==o)return;a=!1}else for(;!(a=(n=c.call(o)).done)&&(i.push(n.value),i.length!==e);a=!0);}catch(t){p=!0,r=t}finally{try{if(!a&&null!=o.return&&(u=o.return(),Object(u)!==u))return}finally{if(p)throw r}}return i}}(e,o)||function(t,e){if(t){if("string"==typeof t)return S(t,e);var o=Object.prototype.toString.call(t).slice(8,-1);return"Object"===o&&t.constructor&&(o=t.constructor.name),"Map"===o||"Set"===o?Array.from(t):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?S(t,e):void 0}}(e,o)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),r=n[0],c=n[1];j.style.backgroundImage="url(".concat(r.avatar,")"),w.textContent=r.name,O.textContent=r.about,c.forEach((function(t){h.append(p(t,i,u,V,a))}))})).catch((function(t){console.log(t)})),b.forEach((function(t){t.classList.add("popup_is-animated"),t.addEventListener("click",(function(e){e.target.closest(".popup__content")||s(t)})),t.querySelector(".popup__close").addEventListener("click",(function(){s(t)}))})),j.addEventListener("click",(function(){l(q),v(T,{formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_inactive",inputErrorClass:"popup__input_invalid",errorClass:"popup__input-error_active"}),y({formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_inactive",inputErrorClass:"popup__input_invalid",errorClass:"popup__input-error_active"})})),B.addEventListener("click",(function(){l(C),v(A,{formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_inactive",inputErrorClass:"popup__input_invalid",errorClass:"popup__input-error_active"}),M.value=w.textContent,N.value=O.textContent,y({formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_inactive",inputErrorClass:"popup__input_invalid",errorClass:"popup__input-error_active"})})),A.addEventListener("submit",(function(n){n.preventDefault(),$(C,!0),G=M.value,H=N.value,fetch("".concat(t,"/users/me"),{method:"PATCH",headers:{authorization:"".concat(e),"Content-Type":"".concat(o)},body:JSON.stringify({name:G,about:H})}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).then((function(t){w.textContent=t.name,O.textContent=t.about})).catch((function(t){console.log(t)})).finally((function(){return $(C,!1)})),s(C)})),x.addEventListener("click",(function(){l(k),v(P,{formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_inactive",inputErrorClass:"popup__input_invalid",errorClass:"popup__input-error_active"}),y({formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_inactive",inputErrorClass:"popup__input_invalid",errorClass:"popup__input-error_active"})})),P.addEventListener("submit",(function(n){n.preventDefault(),$(k,!0),U.name=z.value,U.link=D.value,fetch("".concat(t,"/cards"),{method:"POST",headers:{authorization:"".concat(e),"Content-Type":"".concat(o)},body:JSON.stringify({name:U.name,link:U.link})}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).then((function(t){console.log(t),h.prepend(p(t,i,u,V,a))})).catch((function(t){console.log(t)})).finally((function(){$(k,!1)})),P.reset(),v(P,{formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_inactive",inputErrorClass:"popup__input_invalid",errorClass:"popup__input-error_active"}),s(k)})),T.addEventListener("submit",(function(n){n.preventDefault(),$(q,!0),J=I.value,fetch("".concat(t,"/users/me/avatar"),{method:"PATCH",headers:{authorization:"".concat(e),"Content-Type":"".concat(o)},body:JSON.stringify({avatar:J})}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).then((function(t){console.log(t),j.style.backgroundImage="url(".concat(t.avatar,")")})).catch((function(t){console.log(t)})).finally((function(){$(q,!1)})),s(q)}))})();